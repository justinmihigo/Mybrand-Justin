<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="Author" content="Justin Mihigo">
    <title>Justin Mihigo</title>
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/articleList.css">
    <link rel="stylesheet" href="../css/queries.css">
    <link rel="shortcut icon" href="../resources/logo.svg" type="image/svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>

<body>
    <header>
        <nav>
            <div id="logo">
                <img src="../resources/justin-full.svg" width="150" height="auto" alt="mylogo" />
            </div>
            <i class="fa-solid fa-bars" id="bars"></i>
            <input type="text" id="search" placeholder="Search">
            <a href="../index.html">Back to home</a>
            </div>
            <div class="status">
                <span>
                    <i class="fa-solid fa-bell" id="tilt"></i>
                    <i class="fa-solid fa-caret-down"></i>&nbsp;
                    <span class="number">4+</span>
                </span>
                <span>
                    <i class="fa-solid fa-message"></i>
                    <i class="fa-solid fa-caret-down"></i>&nbsp;
                    <span class="number">4+</span>
                </span>
                <span>
                    <i class="fa-regular fa-circle-user"></i>
                    <i class="fa-solid fa-caret-down"></i>
                </span>
            </div>
        </nav>
    </header>
    <section class="main" id="main">
        <div class="aside">
            <div class="profile">
                <i class="fa-regular fa-circle-user"></i><span class="green">Justin Mihigo<br>
                    online <i class="fa-solid fa-caret-down"></i><span>
            </div>
            <div class="link">
                <a href="#"> <i class="fa-solid fa-house"></i> <span><b>Dashboard</b></span></a>
            </div>
            <div class="link">
                <a href="./articleList.html"> <i class="fa-solid fa-newspaper"></i> <span><b>Articles</b></span></a>
            </div>
            <div class="link">
                <a href="#reports"> <i class="fa-solid fa-chart-simple"></i> <span><b>Reports</b></span></a>
            </div>
            <div class="link">
                <a href="#"><i class="fa-solid fa-clock-rotate-left"></i> <span><b>Queries</b></span></a>
            </div>
            <div class="link">
                <a href="./skillsList.html"><i class="fa-solid fa-brain"></i></i> <span><b>Skills</b></span></a>
            </div>
        </div>
        <div class="middle">
            <section class="queries">
                <div class="recent-messages" id="recents">
                    <h3 class="blue center">Recent Queries</h3>
                    <!-- <div class="message padding">
                            <p><b>Mukunzi Yvan</b> 
                                <span class="rating">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                </span>
                                &nbsp; &nbsp;<span class="grey">58 min ago</span></p>
                            <p class="justify">
                                Hey Justin, I wanted to tell you that after thoroughly, 
                                going through your projects, I want to talk to you.
                            </p><br>
                            <div class="reactions">
                                <i class="fa-solid fa-thumbs-up"></i>&nbsp; <span>Like</span> &nbsp;&nbsp;
                                
                                <i class="fa-solid fa-share"></i>&nbsp; <span>Reply</span>
                            </div>
                        </div>
                        <div class="message padding">
                            <p><b>Mukunzi Yvan</b> 
                                <span class="rating">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                </span>
                                &nbsp; &nbsp;<span class="grey">58 min ago</span></p>
                            <p class="justify">
                                Hey Justin, I wanted to tell you that after thoroughly, 
                                going through your projects, I want to talk to you.
                            </p><br>
                            <div class="reactions">
                                <i class="fa-solid fa-thumbs-up"></i>&nbsp; <span>Like</span> &nbsp;&nbsp;
                                
                                <i class="fa-solid fa-share"></i>&nbsp; <span>Reply</span>
                            </div>
                        </div>
                        <div class="message padding">
                            <p><b>Mukunzi Yvan</b> 
                                <span class="rating">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                </span>
                                &nbsp; &nbsp;<span class="grey">58 min ago</span></p>
                            <p class="justify">
                                Hey Justin, I wanted to tell you that after thoroughly, 
                                going through your projects, I want to talk to you.
                            </p><br>
                            <div class="reactions">
                                <i class="fa-solid fa-thumbs-up"></i>&nbsp; <span>Like</span> &nbsp;&nbsp;
                                
                                <i class="fa-solid fa-share"></i>&nbsp; <span>Reply</span>
                            </div>
                        </div> -->
                </div>
            </section>
            <div class="reply">
                <textarea name="message" id="message" cols="50" rows="5" placeholder="Your message here"></textarea>
                <button class="button">Reply</button>
            </div>
    </section>
    <script>
        async function fetchQuery() {
            const response = await fetch('https://mybrand-be-1-mzvx.onrender.com/api/queries');
            const data = await response.json();
            console.log(data);
            const queriesContainer = document.getElementById('recents');
            for (let query of data.queries) {
                queriesContainer.innerHTML +=
                    `<div class="message padding">
                            <p><b>${query.name}</b> 
                                <span class="rating">
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                    <i class="fa-solid fa-star"></i>
                                </span>
                                &nbsp; &nbsp;<span class="grey">${(query.date).replace('T', ' ').substring(0, 15)}</span></p>
                            <p class="justify">
                                ${query.query}
                            </p><br>
                            <div class="reactions">
                                <i class="fa-solid fa-trash" data-query-id='${query._id}'></i>&nbsp; <span>Delete</span> &nbsp;&nbsp;
                                
                                <i class="fa-solid fa-share" data-query-id='${query._id}'></i>&nbsp; <span>Reply</span>
                            </div>
                        </div>`;
            }
            queriesContainer.addEventListener('click', (e) => {
                let target = e.target;
                if (target.classList.contains('fa-trash')) {
                    let queryId = target.getAttribute('data-query-id');
                    console.log(queryId);
                    fetch(`http://localhost:5000/api/queries/${queryId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                        .then(res => {
                            if (!res.ok) {
                                throw new Error('Failed to delete query');
                            }
                            return res.json();
                        })
                        .then(data => {
                            alert('Query deleted successfully:', data);
                            window.setTimeout(()=>{window.location.reload()},1000)
                            // Handle successful deletion
                        })
                        .catch(error => {
                            console.log('Error deleting query:', error);
                        });
                }
                else if (target.classList.contains('fa-share')) {
                    let queryId = target.getAttribute('data-query-id');
                    console.log(queryId);
                    fetch(`http://localhost:5000/api/queries/${queryId}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                      .then(res => {
                            if (!res.ok) {
                                throw new Error('Failed to fetch query');
                            }
                            return res.json();
                        })
                      .then(data => {
                            console.log('Query fetched successfully:', data);
                            let reply = document.getElementById('message');
                            reply.value = data.query;
                        })
                      .catch(error => {
                            console.log('Error fetching query:', error);
                        });
                }

            });
        }
        fetchQuery();
    </script>
</body>

</html>